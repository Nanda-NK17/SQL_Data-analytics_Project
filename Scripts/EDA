--Explore all objects in the database
SELECT * FROM INFORMATION_SCHEMA.TABLES

--Explore all COLUMNS in the database
SELECT * FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'dim_customers'

--Find the date of the first and last order
SELECT
MIN(order_date) AS first_order_date,
MAX(order_Date) AS last_order_date,
DATEDIFF(year, MIN(order_date),MAX(order_Date)  ) AS date_range
FROM gold.fact_sales;

--Find the youngest and the olderst customer
SELECT
MIN(birthdate) AS oldest_customer,
DATEDIFF (YEAR, MIN(birthdate), GETDATE()) AS oldest_age,
MAX(birthdate) AS youngest_customer,
DATEDIFF(year, MAX(birthdate) ,GETDATE() ) AS youngest_age
FROM gold.dim_customers;

--Find the total sales
SELECT SUM(sales_amount) AS total_Sales FROM gold.fact_Sales;

--Find the average selling price
SELECT AVG(price) AS avg_price FROM gold.fact_Sales;

--Find the total no of orders
SELECT COUNT (order_number) AS total_orders FROM gold.fact_sales;
SELECT COUNT (DISTINCT order_number) AS total_orders FROM gold.fact_sales;

--Find the total no of products
SELECT COUNT (product_name) AS total_products FROM gold.dim_products;
SELECT COUNT (DISTINCT product_name) AS total_products FROM gold.dim_products;

--Find the total no of customers
SELECT COUNT (customer_key) AS total_customers FROM gold.dim_customers;

--Find the total no of customers that has places an order
SELECT COUNT (DISTINCT customer_key) AS total_customers FROM gold.fact_sales;

--Generate a report that shows all the key metrics of the business

SELECT 'Total sales' AS measure_name, SUM (sales_amount) AS measure_value FROM gold.fact_sales
UNION ALL
SELECT 'Total quantity', SUM (quantity) FROM gold.fact_sales
UNION ALL
SELECT 'Average price', AVG (price) FROM gold.fact_sales
UNION ALL
SELECT 'Total Nr. orders', COUNT (DISTINCT order_number) FROM gold.fact_sales
UNION ALL
SELECT 'Total Nr. products', COUNT (product_name) FROM gold.dim_products
UNION ALL
SELECT 'Total Nr. customers', COUNT (customer_key) FROM gold.dim_customers;

--What is the total revenue generated for each category?
SELECT
p.category,
SUM(f.sales_amount) total_revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_products p
ON p.product_key = f.product_key
GROUP BY p.category
ORDER BY total_revenue DESC;

--What is the total revenue generated by each customer
SELECT
c.customer_key,
c.first_name,
c.last_name,
SUM(f.sales_amount) AS total_revenue
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON c.customer_key = f.customer_key
GROUP BY
c.customer_key,
c.first_name,
c.last_name
ORDER BY total_revenue DESC;

--What is the distribution of sold items across countries?
SELECT
c.country,
SUM(f.quantity) AS total_sold_items
FROM gold.fact_sales f
LEFT JOIN gold.dim_customers c
ON c.customer_key = f.customer_key
GROUP BY
c.country
ORDER BY total_sold_items DESC;
